<div id="cte-esport-root">
    <div id="cte-esport-panel">
        <!-- 1. 标题栏 -->
        <div class="cte-esport-header">
            <h2 class="cte-esport-title">CTE E-SPORTS MAP</h2>
            <div class="cte-esport-controls">
                <button class="cte-esport-icon-btn" id="cte-btn-reset-bg" title="恢复原始背景">🔄</button>
                <label for="cte-bg-upload" class="cte-esport-icon-btn" title="更换地图背景" style="display:flex; align-items:center; justify-content:center;">🖼️</label>
                <input type="file" id="cte-bg-upload" accept="image/*" style="display: none;">
                
                <button class="cte-esport-icon-btn" id="cte-btn-theme" title="切换主题">🎨</button>
                <button class="cte-esport-icon-btn" id="cte-btn-close" title="关闭">✕</button>
            </div>
        </div>

        <!-- 2. 主体区域 (层叠) -->
        <div class="cte-esport-body">
            
            <!-- 底层：可滚动的地图层 -->
            <div class="cte-esport-scroll-layer">
                <div class="cte-esport-map-canvas" id="cte-map-canvas">
                    <!-- 地标点 -->
                    <div class="cte-esport-pin" id="cte-pin-base" style="left: 400px; top: 400px;" data-popup="popup-cte">
                        <div class="cte-esport-pin-label">CTE战队基地</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 600px; top: 480px;" data-popup="popup-baibu">
                        <div class="cte-esport-pin-label">百步街</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 700px; top: 720px;" data-popup="popup-snack">
                        <div class="cte-esport-pin-label">小吃街</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 650px; top: 320px;" data-popup="popup-wanda">
                        <div class="cte-esport-pin-label">万达广场</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 700px; top: 400px;" data-popup="popup-aurora">
                        <div class="cte-esport-pin-label">极光电竞馆</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 150px; top: 500px;" data-popup="popup-netbar">
                        <div class="cte-esport-pin-label">星夜网吧</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 400px; top: 100px;" data-popup="popup-park">
                        <div class="cte-esport-pin-label">蓝海公园</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 80px; top: 400px;" data-popup="popup-wancheng">
                        <div class="cte-esport-pin-label">万城娱乐总部</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 100px; top: 100px;" data-popup="popup-nightmarket">
                        <div class="cte-esport-pin-label">老街区夜市</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 700px; top: 100px;" data-popup="popup-school">
                        <div class="cte-esport-pin-label">京港第三高中</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 100px; top: 700px;" data-popup="popup-library">
                        <div class="cte-esport-pin-label">城市图书馆</div>
                    </div>
                     <div class="cte-esport-pin" style="left: 180px; top: 680px;" data-popup="popup-hotel">
                        <div class="cte-esport-pin-label">电竞酒店</div>
                    </div>
                    <div class="cte-esport-pin" style="left: 600px; top: 650px;" data-popup="popup-custom">
                        <div class="cte-esport-pin-label">其他地点</div>
                    </div>
                </div>
            </div>

            <!-- 顶层：UI 弹窗层 -->
            <div class="cte-esport-ui-layer" id="cte-ui-layer">
                
                <!-- 新增：通用角色资料卡片弹窗 (内容由 JS 动态填充) -->
                <div class="cte-esport-popup" id="cte-profile-modal">
                    <div class="cte-popup-header">
                        <span class="cte-popup-title">角色档案</span>
                        <span class="cte-close-btn">×</span>
                    </div>
                    <div class="cte-profile-content">
                        <!-- 头像区域 -->
                        <div class="cte-profile-avatar-container">
                            <div class="cte-profile-avatar-wrapper">
                                <img id="cte-profile-img" src="" alt="Avatar">
                                <!-- 玩家专属：上传按钮 -->
                                <label for="cte-user-avatar-input" id="cte-avatar-upload-btn" title="上传头像">📷</label>
                                <input type="file" id="cte-user-avatar-input" accept="image/*" style="display:none;">
                            </div>
                            <!-- 玩家专属：删除按钮 -->
                             <button id="cte-avatar-delete-btn" title="删除头像">🗑️</button>
                        </div>

                        <!-- 信息区域 -->
                        <div class="cte-profile-info">
                            <h3 id="cte-profile-name">姓名</h3>
                            <div class="cte-profile-grid">
                                <div class="cte-profile-item">
                                    <span class="label">年龄</span>
                                    <span class="value" id="cte-profile-age">--</span>
                                </div>
                                <div class="cte-profile-item">
                                    <span class="label">身份</span>
                                    <span class="value" id="cte-profile-role">--</span>
                                </div>
                            </div>
                            <div class="cte-profile-full-item">
                                <span class="label">性格</span>
                                <span class="value" id="cte-profile-personality">--</span>
                            </div>
                            <div class="cte-profile-desc" id="cte-profile-desc">
                                房间描述文本...
                            </div>
                        </div>
                    </div>
                    <button class="cte-action-btn" id="cte-profile-go-btn">🚀 前往此处</button>
                </div>

                <!-- 弹窗：CTE 基地 -->
                <div class="cte-esport-popup" id="popup-cte">
                    <div class="cte-popup-header">
                        <span class="cte-popup-title">CTE 战队基地</span>
                        <span class="cte-close-btn">×</span>
                    </div>
                    <div class="cte-popup-content">
                        <p>坐标核心：由独立别墅改造的现代建筑，外墙印有巨型CTE战队标识。</p>
                        <img src="https://files.catbox.moe/t0f84b.png" alt="Base">
                        <div style="display:flex; gap:10px;">
                            <button class="cte-action-btn" data-action="interior" style="flex:1;">📂 查看内部布局</button>
                            <button class="cte-action-btn" data-travel="CTE战队基地" style="flex:1;">🚀 前往此处</button>
                        </div>
                    </div>
                </div>

                <!-- 弹窗：基地内部 -->
                <div class="cte-esport-popup" id="popup-interior">
                    <div class="cte-popup-header">
                        <span class="cte-popup-title">基地内部档案</span>
                        <span class="cte-close-btn">×</span>
                    </div>
                    <div class="cte-popup-content" style="display: flex; flex-direction: column;">
                        
                        <div style="width: 100%; margin-bottom: 20px;">
                            <img src="https://files.catbox.moe/lhw7xk.png" alt="FloorPlan" style="width:100%;">
                            <button class="cte-action-btn" data-action="back-base" style="margin-top: 5px; font-size: 12px; padding: 5px;">⬅ 返回外观</button>
                        </div>

                        <div class="cte-floor-group" style="width: 100%; margin-top: 0;">
                            <p style="font-size:12px; color:var(--cte-text-sub); text-align:left; border-bottom: 1px solid var(--cte-border-color); padding-bottom: 5px; margin-bottom: 10px;">楼层导航 (点击展开)</p>

                            <button class="cte-floor-btn" data-target="f-roof">☁️ 顶楼：休闲天台</button>
                            <div class="cte-floor-panel" id="f-roof">
                                <span class="cte-room-tag" data-travel="CTE基地-顶楼天台">顶楼天台</span>
                            </div>

                            <button class="cte-floor-btn" data-target="f5">🛏️ 五层：居住区 (点击查看资料)</button>
                            <div class="cte-floor-panel" id="f5">
                                <!-- 修改：data-profile 属性指向角色ID -->
                                <span class="cte-room-tag" data-profile="wei_yuehua">魏月华</span>
                                <span class="cte-room-tag" data-profile="qin_shu">秦述</span>
                                <span class="cte-room-tag" data-profile="si_luo">司洛</span>
                                <span class="cte-room-tag" data-profile="lu_yan">鹿言</span>
                                <span class="cte-room-tag" data-profile="wei_xingze">魏星泽</span>
                                <span class="cte-room-tag" data-profile="zhou_jinning">周锦宁</span>
                                <span class="cte-room-tag" data-profile="chen_xu">谌绪</span>
                                <span class="cte-room-tag" data-profile="meng_minghe">孟明赫</span>
                                <span class="cte-room-tag" data-profile="qi_xie">亓谢</span>
                                <span class="cte-room-tag" data-profile="sang_luofan">桑洛凡</span>
                                <span class="cte-room-tag" data-profile="user" style="border-color: var(--cte-accent-gold); color:var(--cte-accent-gold);">你的房间</span>
                                <span class="cte-room-tag" data-travel="CTE基地-五楼休憩区">公共休憩区</span>
                            </div>

                            <button class="cte-floor-btn" data-target="f4">💪 四层：康复与健身</button>
                            <div class="cte-floor-panel" id="f4">
                                <span class="cte-room-tag" data-travel="CTE基地-健身房">健身房</span>
                                <span class="cte-room-tag" data-travel="CTE基地-瑜伽室">瑜伽室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-理疗室">按摩理疗室</span>
                            </div>

                            <button class="cte-floor-btn" data-target="f3">🖥️ 三层：训练区</button>
                            <div class="cte-floor-panel" id="f3">
                                <span class="cte-room-tag" data-travel="CTE基地-主训练室">主训练室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-副训练室">副训练室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-战术会议室">战术会议室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-选手休息室">选手休息室</span>
                            </div>

                            <button class="cte-floor-btn" data-target="f2">📹 二层：运营与内容</button>
                            <div class="cte-floor-panel" id="f2">
                                <span class="cte-room-tag" data-travel="CTE基地-采访室">采访室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-直播间">直播间</span>
                                <span class="cte-room-tag" data-travel="CTE基地-创作室">创作工作室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-教练办公室">教练办公室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-经理办公室">经理办公室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-观赛区">观赛区</span>
                            </div>

                            <button class="cte-floor-btn" data-target="f1">🛋️ 一层：生活区</button>
                            <div class="cte-floor-panel" id="f1">
                                <span class="cte-room-tag" data-travel="CTE基地-前院">前院花园</span>
                                <span class="cte-room-tag" data-travel="CTE基地-大厅">接待大厅</span>
                                <span class="cte-room-tag" data-travel="CTE基地-餐厅">餐厅/厨房</span>
                                <span class="cte-room-tag" data-travel="CTE基地-洗衣房">洗衣房</span>
                                <span class="cte-room-tag" data-travel="CTE基地-医务室">医务室</span>
                                <span class="cte-room-tag" data-travel="CTE基地-后院">后院泳池</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 旅行确认弹窗 -->
                <div class="cte-esport-popup" id="cte-travel-modal" style="width: 350px;">
                    <div class="cte-popup-header">
                        <span class="cte-popup-title">确认行程</span>
                        <span class="cte-close-btn">×</span>
                    </div>
                    <div class="cte-popup-content" style="text-align: center;">
                        <p style="color: var(--cte-text-sub); margin-bottom: 5px;">目的地</p>
                        <h3 id="cte-travel-dest-name" style="color: var(--cte-accent-gold); margin: 0 0 20px 0; font-size: 1.5em;">Destination</h3>
                        
                        <button class="cte-action-btn" id="cte-travel-alone">👤 独自前往</button>
                        
                        <div style="margin: 20px 0; border-top: 1px solid var(--cte-border-color); position: relative;">
                            <span style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--cte-panel-bg); padding: 0 10px; color: var(--cte-text-sub); font-size: 12px;">OR</span>
                        </div>

                        <div style="text-align: left;">
                            <label style="font-size: 12px; color: var(--cte-text-sub);">邀请同伴：</label>
                            <input type="text" id="cte-companion-input" placeholder="输入同伴名字 (如: 秦述)" 
                                   style="width: 100%; padding: 10px; margin: 5px 0 10px 0; background: rgba(0,0,0,0.2); border: 1px solid var(--cte-border-color); color: var(--cte-text-main); border-radius: 4px; box-sizing: border-box;">
                            <button class="cte-action-btn" id="cte-travel-companion">👥 邀请同伴前往</button>
                        </div>
                    </div>
                </div>

                <!-- 其他地点弹窗保持不变 -->
                <div class="cte-esport-popup" id="popup-baibu">
                    <div class="cte-popup-header"><span>百步街</span><span class="cte-close-btn">×</span></div>
                    <ul class="cte-loc-list">
                        <li class="cte-loc-item" data-travel="猫咪咖啡馆"><strong>🐱 猫咪咖啡馆</strong><span> - 附近有宠物医院</span></li>
                        <li class="cte-loc-item" data-travel="老张文具店"><strong>🖊️ 老张文具店</strong><span> - 旧时光的记忆</span></li>
                        <li class="cte-loc-item" data-travel="老字号面馆"><strong>🍜 老字号面馆</strong><span> - 选手早餐首选</span></li>
                        <li class="cte-loc-item" data-travel="花间茶社"><strong>🍵 花间茶社</strong><span> - 适合谈话下棋</span></li>
                        <li class="cte-loc-item" data-travel="404便利店"><strong>🏪 404便利店</strong><span> - 24小时营业</span></li>
                    </ul>
                </div>
                <div class="cte-esport-popup" id="popup-wanda">
                    <div class="cte-popup-header"><span>万达广场</span><span class="cte-close-btn">×</span></div>
                    <ul class="cte-loc-list">
                        <li class="cte-loc-item" data-travel="CGV影城"><strong>🎬 CGV影城</strong></li>
                        <li class="cte-loc-item" data-travel="海底捞火锅"><strong>🍲 海底捞火锅</strong><span> - 聚餐热门</span></li>
                        <li class="cte-loc-item" data-travel="电玩城"><strong>🎮 电玩城</strong></li>
                        <li class="cte-loc-item" data-travel="星光书店"><strong>📖 星光书店</strong><span> - 2F 咖啡阅读区</span></li>
                        <li class="cte-loc-item" data-travel="潮玩集合店"><strong>🧸 潮玩集合店</strong><span> - 1F</span></li>
                        <li class="cte-loc-item" data-travel="星空天台酒吧"><strong>🥂 星空天台酒吧</strong><span> - 顶层</span></li>
                        <li class="cte-loc-item" data-travel="健身俱乐部"><strong>🏋️ 健身俱乐部</strong></li>
                    </ul>
                </div>
                <div class="cte-esport-popup" id="popup-snack">
                    <div class="cte-popup-header"><span>小吃街</span><span class="cte-close-btn">×</span></div>
                    <ul class="cte-loc-list">
                        <li class="cte-loc-item" data-travel="老王烧烤"><strong>🍖 老王烧烤</strong></li>
                        <li class="cte-loc-item" data-travel="糖葫芦摊"><strong>🍡 糖葫芦摊</strong></li>
                        <li class="cte-loc-item" data-travel="麻辣烫小店"><strong>🍲 麻辣烫小店</strong></li>
                        <li class="cte-loc-item" data-travel="甜品屋"><strong>🍰 甜品屋</strong></li>
                        <li class="cte-loc-item" data-travel="be drunk酒吧"><strong>🍸 be drunk酒吧</strong></li>
                    </ul>
                    <button class="cte-action-btn" data-travel="小吃街">🚀 前往小吃街路口</button>
                </div>
                <div class="cte-esport-popup" id="popup-aurora">
                    <div class="cte-popup-header"><span>极光电竞馆</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>大型电竞场馆，定期举办小型赛事。CTE战队有时在此进行公开训练。</p>
                        <button class="cte-action-btn" data-travel="极光电竞馆">🚀 前往</button>
                    </div>
                </div>
                <div class="cte-esport-popup" id="popup-netbar">
                    <div class="cte-popup-header"><span>星夜网吧</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>步行5分钟可达的高端网吧，配置顶级。司洛是这里的常客。</p>
                        <button class="cte-action-btn" data-travel="星夜网吧">🚀 前往</button>
                    </div>
                </div>
                 <div class="cte-esport-popup" id="popup-park">
                    <div class="cte-popup-header"><span>蓝海公园</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>基地北侧的静谧湖畔公园，秦述常在此晨跑。</p>
                        <button class="cte-action-btn" data-travel="蓝海公园">🚀 前往</button>
                    </div>
                </div>
                 <div class="cte-esport-popup" id="popup-wancheng">
                    <div class="cte-popup-header"><span>万城娱乐总部</span><span class="cte-close-btn">×</span></div>
                     <div class="cte-popup-content">
                        <p>距基地2公里。掌控着战队的商业命脉。</p>
                        <button class="cte-action-btn" data-travel="万城娱乐总部">🚀 前往</button>
                    </div>
                </div>
                 <div class="cte-esport-popup" id="popup-nightmarket">
                    <div class="cte-popup-header"><span>老街区夜市</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>传统夜市，拥有浓郁的本土生活气息。</p>
                        <button class="cte-action-btn" data-travel="老街区夜市">🚀 前往</button>
                    </div>
                </div>
                 <div class="cte-esport-popup" id="popup-school">
                    <div class="cte-popup-header"><span>京港第三高中</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>省重点高中，谌绪就读地。充满青春气息与书卷气。</p>
                        <button class="cte-action-btn" data-travel="京港第三高中">🚀 前往</button>
                    </div>
                </div>
                 <div class="cte-esport-popup" id="popup-library">
                    <div class="cte-popup-header"><span>城市图书馆</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>现代化图书馆，内设电竞文化专区，安静学习的好去处。</p>
                        <button class="cte-action-btn" data-travel="城市图书馆">🚀 前往</button>
                    </div>
                </div>
                 <div class="cte-esport-popup" id="popup-hotel">
                    <div class="cte-popup-header"><span>电竞酒店</span><span class="cte-close-btn">×</span></div>
                    <div class="cte-popup-content">
                        <p>设有电竞主题客房及观赛厅，常有外地粉丝与职业选手造访。</p>
                        <button class="cte-action-btn" data-travel="电竞酒店">🚀 前往</button>
                    </div>
                </div>
                <div class="cte-esport-popup" id="popup-custom">
                    <div class="cte-popup-header"><span>自定义地点</span><span class="cte-close-btn">×</span></div>
                    <input type="text" id="cte-custom-input" placeholder="输入你想去的地方..." style="width:100%; padding:10px; margin-bottom:10px; background:#333; border:1px solid #555; color:#fff;">
                    <button class="cte-action-btn" id="cte-btn-custom-go">🚀 出发</button>
                </div>

            </div>
        </div>
    </div>
</div>
